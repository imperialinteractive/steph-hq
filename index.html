<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Home Base ğŸŒ¿</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f0ebe3;
    --card: #e8e0d5;
    --card2: #ddd4c6;
    --brown: #8b6f5e;
    --brown-dark: #6b4f3f;
    --green: #7a9e7e;
    --green-light: #a8c5a0;
    --text: #3d2e26;
    --text-light: #7a6a5e;
    --white: #faf7f3;
    --check: #7a9e7e;
    --radius: 16px;
    --shadow: 0 2px 12px rgba(61,46,38,0.10);
  }

  body {
    font-family: -apple-system, 'Georgia', serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    max-width: 480px;
    margin: 0 auto;
  }

  /* SCREENS */
  .screen { display: none; padding: 0 0 80px 0; min-height: 100vh; }
  .screen.active { display: block; }

  /* HEADER */
  .header {
    background: var(--bg);
    padding: 52px 20px 16px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  .header .back {
    position: absolute;
    left: 20px;
    top: 54px;
    font-size: 14px;
    color: var(--brown);
    cursor: pointer;
    font-family: -apple-system, sans-serif;
  }
  .header h1 {
    font-size: 28px;
    font-weight: 700;
    font-style: italic;
    color: var(--text);
    letter-spacing: -0.5px;
  }
  .header p {
    font-size: 13px;
    color: var(--text-light);
    font-family: -apple-system, sans-serif;
    margin-top: 2px;
  }

  /* HOME GRID */
  .home-header {
    padding: 60px 20px 20px;
    text-align: center;
  }
  .home-header h1 {
    font-size: 34px;
    font-style: italic;
    font-weight: 700;
    color: var(--text);
  }
  .home-header p {
    color: var(--text-light);
    font-size: 14px;
    margin-top: 4px;
    font-family: -apple-system, sans-serif;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    padding: 0 16px 20px;
  }
  .tile {
    background: #d9c9b4;
    border-radius: 24px;
    padding: 26px 16px 22px;
    cursor: pointer;
    transition: transform 0.15s, filter 0.15s;
    box-shadow: 0 4px 16px rgba(100,75,50,0.13);
    text-align: center;
    user-select: none;
  }
  .tile:active { transform: scale(0.96); filter: brightness(0.95); }
  .tile .tile-emoji { font-size: 34px; display: block; margin-bottom: 10px; }
  .tile .tile-label {
    font-size: 14px;
    font-family: -apple-system, sans-serif;
    color: #4a3728;
    font-weight: 600;
  }

  /* PROGRESS RING */
  .ring-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 0 10px;
  }
  .ring-container { position: relative; width: 120px; height: 120px; }
  .ring-container svg { transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: var(--card2); stroke-width: 8; }
  .ring-fill { fill: none; stroke: var(--green); stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 0.4s ease; }
  .ring-text {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  .ring-text .ring-count { font-size: 22px; font-weight: 700; color: var(--text); font-style: italic; }
  .ring-text .ring-pct { font-size: 11px; color: var(--text-light); font-family: -apple-system, sans-serif; }
  .ring-date {
    font-size: 15px;
    color: var(--text-light);
    margin-top: 8px;
    font-family: -apple-system, sans-serif;
  }

  /* CHECKLIST */
  .checklist { padding: 8px 16px; }
  .check-item {
    display: flex;
    align-items: center;
    background: var(--card);
    border-radius: 14px;
    padding: 14px 16px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: background 0.15s;
    box-shadow: var(--shadow);
    gap: 12px;
    user-select: none;
  }
  .check-item.done { opacity: 0.5; }
  .check-item .ci-radio {
    width: 24px; height: 24px; min-width: 24px;
    border-radius: 50%;
    border: 2px solid var(--brown);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    background: transparent;
  }
  .check-item.done .ci-radio {
    background: var(--green);
    border-color: var(--green);
  }
  .check-item.done .ci-radio::after {
    content: 'âœ“';
    color: white;
    font-size: 13px;
    font-weight: 700;
  }
  .check-item .ci-emoji { font-size: 20px; }
  .check-item .ci-label {
    font-size: 15px;
    font-family: -apple-system, sans-serif;
    color: var(--text);
    flex: 1;
  }
  .check-item.done .ci-label { text-decoration: line-through; color: var(--text-light); }

  /* LISTS */
  .list-section { padding: 0 16px; }
  .list-section h2 {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-light);
    font-family: -apple-system, sans-serif;
    margin: 20px 0 10px;
  }
  .list-item {
    display: flex;
    align-items: center;
    background: var(--card);
    border-radius: 14px;
    padding: 14px 16px;
    margin-bottom: 8px;
    gap: 12px;
    box-shadow: var(--shadow);
  }
  .list-item .li-check {
    width: 22px; height: 22px; min-width: 22px;
    border-radius: 50%;
    border: 2px solid var(--brown);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
  }
  .list-item.done .li-check {
    background: var(--green);
    border-color: var(--green);
  }
  .list-item.done .li-check::after { content: 'âœ“'; color: white; font-size: 12px; font-weight: 700; }
  .list-item .li-text {
    font-size: 15px;
    font-family: -apple-system, sans-serif;
    color: var(--text);
    flex: 1;
    outline: none;
    background: transparent;
    border: none;
    caret-color: var(--brown);
  }
  .list-item.done .li-text { text-decoration: line-through; color: var(--text-light); }
  .list-item .li-delete {
    color: var(--text-light);
    font-size: 18px;
    cursor: pointer;
    padding: 0 4px;
    opacity: 0.4;
  }
  .list-item .li-delete:hover { opacity: 1; }

  .add-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 16px;
    margin-bottom: 8px;
  }
  .add-input {
    flex: 1;
    background: var(--white);
    border: 1.5px solid var(--card2);
    border-radius: 12px;
    padding: 10px 14px;
    font-size: 15px;
    font-family: -apple-system, sans-serif;
    color: var(--text);
    outline: none;
  }
  .add-input:focus { border-color: var(--green); }
  .add-btn {
    background: var(--green);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 10px 18px;
    font-size: 15px;
    cursor: pointer;
    font-family: -apple-system, sans-serif;
    font-weight: 600;
  }

  /* RECIPE CARDS */
  .recipe-grid { padding: 0 16px; }
  .recipe-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 18px 16px;
    margin-bottom: 12px;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: background 0.15s;
  }
  .recipe-card:active { background: var(--card2); }
  .recipe-card h3 {
    font-size: 17px;
    font-style: italic;
    color: var(--text);
    margin-bottom: 4px;
  }
  .recipe-card p {
    font-size: 13px;
    color: var(--text-light);
    font-family: -apple-system, sans-serif;
  }
  .recipe-card .recipe-tag {
    display: inline-block;
    background: var(--green-light);
    color: var(--brown-dark);
    font-size: 11px;
    font-family: -apple-system, sans-serif;
    border-radius: 20px;
    padding: 3px 10px;
    margin-top: 8px;
  }

  /* RECIPE DETAIL */
  .recipe-detail { padding: 0 16px; }
  .recipe-detail h2 { font-size: 22px; font-style: italic; margin-bottom: 8px; }
  .recipe-detail .rd-source {
    font-size: 13px; color: var(--green); font-family: -apple-system, sans-serif; margin-bottom: 16px;
  }
  .recipe-detail .rd-source a { color: var(--green); }
  .recipe-detail h3 {
    font-size: 14px; text-transform: uppercase; letter-spacing: 1px;
    color: var(--text-light); font-family: -apple-system, sans-serif; margin: 16px 0 8px;
  }
  .recipe-detail p, .recipe-detail li {
    font-size: 15px; font-family: -apple-system, sans-serif;
    color: var(--text); line-height: 1.6; margin-bottom: 6px;
  }
  .recipe-detail ul, .recipe-detail ol { padding-left: 20px; }

  /* NAV BAR */
  .nav { display: none; }

  /* CATEGORY PICKER MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 200;
    align-items: flex-end;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal-sheet {
    background: var(--white);
    border-radius: 24px 24px 0 0;
    padding: 20px 16px 40px;
    width: 100%;
    max-width: 480px;
    box-shadow: 0 -4px 24px rgba(0,0,0,0.12);
  }
  .modal-sheet h3 {
    font-size: 16px;
    font-style: italic;
    color: var(--text);
    margin-bottom: 14px;
    text-align: center;
  }
  .cat-btn {
    display: block;
    width: 100%;
    background: var(--card);
    border: none;
    border-radius: 14px;
    padding: 13px 16px;
    font-size: 15px;
    font-family: -apple-system, sans-serif;
    color: var(--text);
    text-align: left;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background 0.15s;
  }
  .cat-btn:active { background: var(--card2); }

  /* MEAL LOG */
  .meal-log { padding: 0 16px; }
  .macro-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 18px;
    margin-bottom: 12px;
    box-shadow: var(--shadow);
  }
  .macro-card h3 {
    font-size: 14px; text-transform: uppercase; letter-spacing: 1px;
    color: var(--text-light); font-family: -apple-system, sans-serif; margin-bottom: 14px;
  }
  .macro-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px;
  }
  .macro-label { font-size: 14px; font-family: -apple-system, sans-serif; color: var(--text); }
  .macro-val { font-size: 14px; font-family: -apple-system, sans-serif; color: var(--brown); font-weight: 600; }
  .macro-bar-wrap { background: var(--card2); border-radius: 6px; height: 6px; margin-bottom: 14px; }
  .macro-bar { height: 6px; border-radius: 6px; background: var(--green); transition: width 0.4s; }
  .meal-entry {
    background: var(--card);
    border-radius: var(--radius);
    padding: 16px;
    margin-bottom: 10px;
    box-shadow: var(--shadow);
  }
  .meal-entry h4 { font-size: 15px; font-style: italic; color: var(--text); margin-bottom: 4px; }
  .meal-entry p { font-size: 13px; color: var(--text-light); font-family: -apple-system, sans-serif; }

  /* SECTION HEADERS */
  .section-pill {
    display: inline-block;
    background: var(--green-light);
    color: var(--brown-dark);
    border-radius: 20px;
    padding: 4px 14px;
    font-size: 12px;
    font-family: -apple-system, sans-serif;
    font-weight: 600;
    margin: 16px 16px 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
</style>
</head>
<body>

<!-- HOME -->
<div class="screen active" id="screen-home">
  <div class="home-header">
    <h1>Home Base ğŸŒ¿</h1>
  </div>
  <button onclick="checkForUpdates()" style="position:fixed;top:14px;right:16px;background:var(--card);border:none;border-radius:50%;width:38px;height:38px;font-size:18px;cursor:pointer;box-shadow:var(--shadow);z-index:100;display:flex;align-items:center;justify-content:center;">ğŸ”„</button>
  <div class="grid">
    <div class="tile" onclick="showScreen('today')">
      <span class="tile-emoji">âœ…</span>
      <span class="tile-label">Today</span>
    </div>
    <div class="tile" onclick="showScreen('todo')">
      <span class="tile-emoji">ğŸ“‹</span>
      <span class="tile-label">To-Do</span>
    </div>
    <div class="tile" onclick="showScreen('grocery')">
      <span class="tile-emoji">ğŸ›’</span>
      <span class="tile-label">Grocery</span>
    </div>
    <div class="tile" onclick="showScreen('recipes')">
      <span class="tile-emoji">ğŸ½ï¸</span>
      <span class="tile-label">Recipes</span>
    </div>
    <div class="tile" onclick="showScreen('calendar')">
      <span class="tile-emoji">ğŸ“…</span>
      <span class="tile-label">Calendar</span>
    </div>
    <div class="tile" onclick="showScreen('kids')">
      <span class="tile-emoji">ğŸ‘¶</span>
      <span class="tile-label">Kids</span>
    </div>
    <div class="tile" onclick="showScreen('nutrition')">
      <span class="tile-emoji">ğŸ“Š</span>
      <span class="tile-label">Meal Log</span>
    </div>
    <div class="tile" onclick="showScreen('workouts')">
      <span class="tile-emoji">ğŸ’ª</span>
      <span class="tile-label">Workouts</span>
    </div>
    <div class="tile" onclick="showScreen('events')">
      <span class="tile-emoji">ğŸ‰</span>
      <span class="tile-label">Events</span>
    </div>
    <div class="tile" onclick="showScreen('packages')">
      <span class="tile-emoji">ğŸ“¦</span>
      <span class="tile-label">Packages</span>
    </div>
    <div class="tile" onclick="showScreen('wellness')">
      <span class="tile-emoji">ğŸŒ¿</span>
      <span class="tile-label">Wellness</span>
    </div>
  </div>
</div>

<!-- TODAY -->
<div class="screen" id="screen-today">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Today</h1>
    <p id="today-date"></p>
  </div>
  <div class="ring-wrap">
    <div class="ring-container">
      <svg width="120" height="120" viewBox="0 0 120 120">
        <circle class="ring-bg" cx="60" cy="60" r="52"/>
        <circle class="ring-fill" id="ring-fill" cx="60" cy="60" r="52" stroke-dasharray="326.7" stroke-dashoffset="326.7"/>
      </svg>
      <div class="ring-text">
        <div class="ring-count" id="ring-count">0/10</div>
        <div class="ring-pct" id="ring-pct">0%</div>
      </div>
    </div>
  </div>
  <div class="checklist" id="today-checklist">
    <!-- rendered by JS -->
  </div>
</div>

<!-- TO-DO HOME (category grid) -->
<div class="screen" id="screen-todo">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>To-Do</h1>
  </div>
  <div class="grid" id="todo-cat-grid">
    <!-- rendered by JS -->
  </div>
</div>

<!-- TO-DO CATEGORY DETAIL -->
<div class="screen" id="screen-todo-cat">
  <div class="header">
    <span class="back" onclick="showScreen('todo')">â† To-Do</span>
    <h1 id="todo-cat-title">Tasks</h1>
  </div>
  <div id="todo-cat-list"></div>
  <div class="add-row">
    <input class="add-input" id="todo-input" placeholder="Add a task..." onkeydown="if(event.key==='Enter')addTodo()">
    <button class="add-btn" onclick="addTodo()">Add</button>
  </div>
</div>

<!-- GROCERY -->
<div class="screen" id="screen-grocery">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Grocery</h1>
  </div>
  <div class="list-section" id="grocery-list"></div>
  <div class="add-row">
    <input class="add-input" id="grocery-input" placeholder="Add an item..." onkeydown="if(event.key==='Enter')addGrocery()">
    <button class="add-btn" onclick="addGrocery()">Add</button>
  </div>
  <div style="padding: 0 16px 8px; display:flex; gap:10px;">
    <button class="add-btn" style="background:var(--brown);flex:1;" onclick="clearDoneGrocery()">Clear checked âœ“</button>
    <button class="add-btn" style="background:#c0392b;flex:1;" onclick="clearAllGrocery()">Clear all ğŸ—‘ï¸</button>
  </div>
</div>

<!-- RECIPES -->
<div class="screen" id="screen-recipes">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Recipes</h1>
  </div>
  <div class="recipe-grid" id="recipe-grid">
    <!-- rendered by JS -->
  </div>
</div>

<!-- RECIPE DETAIL -->
<div class="screen" id="screen-recipe-detail">
  <div class="header">
    <span class="back" onclick="showScreen('recipes')">â† Recipes</span>
    <h1>Recipe</h1>
  </div>
  <div class="recipe-detail" id="recipe-detail-content"></div>
</div>


<!-- CALENDAR -->
<div class="screen" id="screen-calendar">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Calendar</h1>
    <p id="calendar-updated"></p>
  </div>
  <div class="list-section" id="calendar-content">
    <!-- Updated by Lumen 3x daily -->
  </div>
</div>

<!-- KIDS -->
<div class="screen" id="screen-kids">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Kids</h1>
  </div>
  <div class="list-section">
    <h2>ğŸ‘¦ Rush â€” Age 3.5</h2>
    <div class="list-item"><span class="li-text">Born Aug 27, 2022 â€” strong-willed, big personality ğŸ¦</span></div>
    <div class="list-item"><span class="li-text">No melted cheese ğŸ§€</span></div>
  </div>
  <div class="list-section">
    <h2>ğŸ‘¶ Hayes â€” 5 months</h2>
    <div class="list-item"><span class="li-text">Take monthly photo! ğŸ“¸</span></div>
  </div>
  <div class="list-section" id="kids-todo-section">
    <h2>ğŸ“‹ Kids To-Dos</h2>
    <div id="kids-todo-list"></div>
    <div class="add-row">
      <input class="add-input" id="kids-todo-input" placeholder="Add kids to-do..." onkeydown="if(event.key==='Enter')addKidsTodo()">
      <button class="add-btn" onclick="addKidsTodo()">Add</button>
    </div>
  </div>
  <div class="list-section">
    <h2>ğŸ¤ Playdate Potentials</h2>
    <div id="kids-playdates-list"></div>
    <div class="add-row">
      <input class="add-input" id="kids-playdates-input" placeholder="Add name (e.g. Liam â€” from gym)..." onkeydown="if(event.key==='Enter')addPlaydate()">
      <button class="add-btn" onclick="addPlaydate()">Add</button>
    </div>
  </div>
</div>

<!-- NUTRITION / MEAL LOG -->
<div class="screen" id="screen-nutrition">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Meal Log</h1>
  </div>
  <div class="meal-log">
    <div class="macro-card">
      <h3>Today's Targets</h3>
      <div class="macro-row"><span class="macro-label">ğŸ”¥ Calories</span><span class="macro-val">1,800â€“2,000</span></div>
      <div class="macro-row"><span class="macro-label">ğŸ’ª Protein</span><span class="macro-val">110â€“130g</span></div>
      <div class="macro-row"><span class="macro-label">ğŸŒ¾ Carbs</span><span class="macro-val">~45g / meal Â· ~20g / snack</span></div>
      <div class="macro-row"><span class="macro-label">ğŸŒ¿ Fibre</span><span class="macro-val">25g+</span></div>
      <div class="macro-row"><span class="macro-label">ğŸ¬ Sugar</span><span class="macro-val">&lt;50g</span></div>
    </div>
    <div class="macro-card">
      <h3>Today â€” Feb 28</h3>
      <div class="macro-row"><span class="macro-label">ğŸ”¥ Calories</span><span class="macro-val">922 / 1,800â€“2,000 âœ…</span></div>
      <div class="macro-row"><span class="macro-label">ğŸ’ª Protein</span><span class="macro-val">30g / 110â€“130g âš ï¸</span></div>
      <div class="macro-row"><span class="macro-label">ğŸŒ¾ Carbs</span><span class="macro-val">86g</span></div>
      <div class="macro-row"><span class="macro-label">ğŸŒ¿ Fibre</span><span class="macro-val">5g / 25g+ âš ï¸</span></div>
      <div class="macro-row"><span class="macro-label">ğŸ¬ Sugar</span><span class="macro-val">7g / &lt;50g âœ…</span></div>
    </div>
    <div class="meal-entry">
      <h4>â˜€ï¸ Breakfast â€” Tim's Simply Bacon Sandwich</h4>
      <p>472 cal Â· 10g protein Â· 37g carbs Â· 1g fibre Â· 3g sugar</p>
    </div>
    <div class="meal-entry">
      <h4>ğŸ Lunch â€” Knorr Alfredo, 2 Cheddar Wieners, Broccoli</h4>
      <p>450 cal Â· 20g protein Â· 43g carbs Â· 4g fibre Â· 4g sugar</p>
    </div>
  </div>
</div>

<!-- WORKOUTS -->
<div class="screen" id="screen-workouts">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Workouts</h1>
  </div>
  <div class="list-section">
    <h2>This Week</h2>
    <div class="list-item"><span class="li-text">Mon â€” Full Body Strength ğŸ’ª</span></div>
    <div class="list-item"><span class="li-text">Tue â€” Cardio / Walk ğŸš¶</span></div>
    <div class="list-item"><span class="li-text">Wed â€” Upper Body + Core ğŸ‹ï¸</span></div>
    <div class="list-item"><span class="li-text">Thu â€” Rest or Light Walk ğŸ§˜</span></div>
    <div class="list-item"><span class="li-text">Fri â€” Full Body Strength ğŸ’ª</span></div>
    <div class="list-item"><span class="li-text">Sat â€” Barre + Weights ğŸ©°</span></div>
    <div class="list-item"><span class="li-text">Sun â€” Rest âœ¨</span></div>
  </div>
  <div class="grid" id="workout-day-grid"></div>
</div>

<!-- WORKOUT DAY DETAIL -->
<div class="screen" id="screen-workout-day">
  <div class="header">
    <span class="back" onclick="showScreen('workouts')">â† Workouts</span>
    <h1 id="workout-day-title">Monday</h1>
  </div>
  <div id="workout-day-content" style="padding:0 16px;"></div>
</div>

<!-- EVENTS -->
<div class="screen" id="screen-events">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Events ğŸ‰</h1>
  </div>
  <div class="list-section">
    <h2>ğŸ‚ Birthdays</h2>
    <div id="events-birthdays-list"></div>
    <div class="add-row">
      <input class="add-input" id="events-birthdays-input" placeholder="Add birthday..." onkeydown="if(event.key==='Enter')addEvent('birthdays')">
      <button class="add-btn" onclick="addEvent('birthdays')">Add</button>
    </div>
  </div>
  <div class="list-section">
    <h2>ğŸŠ Holidays</h2>
    <div id="events-holidays-list"></div>
    <div class="add-row">
      <input class="add-input" id="events-holidays-input" placeholder="Add holiday..." onkeydown="if(event.key==='Enter')addEvent('holidays')">
      <button class="add-btn" onclick="addEvent('holidays')">Add</button>
    </div>
  </div>
  <div class="list-section">
    <h2>ğŸ¥‚ Hangouts</h2>
    <div id="events-hangouts-list"></div>
    <div class="add-row">
      <input class="add-input" id="events-hangouts-input" placeholder="Add hangout..." onkeydown="if(event.key==='Enter')addEvent('hangouts')">
      <button class="add-btn" onclick="addEvent('hangouts')">Add</button>
    </div>
  </div>
  <div class="list-section">
    <h2>ğŸ“… Coming Up</h2>
    <div id="events-comingup-list"></div>
    <div class="add-row">
      <input class="add-input" id="events-comingup-input" placeholder="Add something coming up..." onkeydown="if(event.key==='Enter')addEvent('comingup')">
      <button class="add-btn" onclick="addEvent('comingup')">Add</button>
    </div>
  </div>
</div>

<!-- PACKAGES -->
<div class="screen" id="screen-packages">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Packages ğŸ“¦</h1>
  </div>
  <div class="list-section">
    <h2>ğŸšš On The Way</h2>
    <div id="packages-active-list"></div>
    <div class="add-row">
      <input class="add-input" id="packages-input" placeholder="Add package (e.g. Amazon - white sneakers)..." onkeydown="if(event.key==='Enter')addPackage()">
      <button class="add-btn" onclick="addPackage()">Add</button>
    </div>
  </div>
  <div class="list-section">
    <h2>âœ… Arrived</h2>
    <div id="packages-arrived-list"></div>
    <div style="padding:0 16px 8px;">
      <button onclick="clearArrivedPackages()" style="background:none;border:1px solid var(--brown);color:var(--brown);border-radius:12px;padding:8px 18px;font-size:13px;cursor:pointer;font-family:-apple-system,sans-serif;">Clear arrived</button>
    </div>
  </div>
</div>

<!-- WELLNESS -->
<div class="screen" id="screen-wellness">
  <div class="header">
    <span class="back" onclick="showScreen('home')">â† HQ</span>
    <h1>Wellness</h1>
  </div>
  <div id="wellness-goals-section" class="list-section">
    <h2>ğŸ¯ Current Goals</h2>
    <div id="wellness-goals-list"></div>
  </div>
  <div class="add-row">
    <input class="add-input" id="wellness-goals-input" placeholder="Add a goal...">
    <button class="add-btn" onclick="addWellness('goals')">Add</button>
  </div>
  <div id="wellness-selfcare-section" class="list-section">
    <h2>ğŸ§– Self Care</h2>
    <div id="wellness-selfcare-list"></div>
  </div>
  <div class="add-row">
    <input class="add-input" id="wellness-selfcare-input" placeholder="Add self care item...">
    <button class="add-btn" onclick="addWellness('selfcare')">Add</button>
  </div>
</div>

<!-- CATEGORY PICKER MODAL -->
<div class="modal-overlay" id="cat-modal" onclick="closeCatModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <h3 id="cat-modal-title">Which section?</h3>
    <div id="cat-modal-buttons"></div>
  </div>
</div>

<script>
// ---- VERSION (bump this when Lumen updates lists) ----
const APP_VERSION = '2026-02-28-v39';

// ---- DATA ----
const TODAY_ITEMS = [
  { id: 1, emoji: 'ğŸ’ª', label: 'Workout / movement' },
  { id: 2, emoji: 'ğŸ¥©', label: 'Protein goal (110â€“130g)' },
  { id: 3, emoji: 'ğŸ¥¦', label: 'Fibre goal (25g+)' },
  { id: 4, emoji: 'ğŸ’§', label: 'Water 1L' },
  { id: 5, emoji: 'ğŸ’§', label: 'Water 2L' },
  { id: 6, emoji: 'ğŸ’§', label: 'Water 3L' },
  { id: 7, emoji: 'ğŸ§˜', label: '10 min stretch' },
  { id: 8, emoji: 'ğŸ’Š', label: 'Vitamins' },
  { id: 9, emoji: 'ğŸš¶', label: '7,500 steps' },
  { id: 10, emoji: 'ğŸ˜Œ', label: 'Calm mom moment' },
];

const RECIPES = [
  {
    id: 1,
    name: 'One Pan Lemon Pepper Yogurt Chicken & Rice',
    desc: 'Half Baked Harvest Â· Family favourite Â· 55 min',
    cat: 'ğŸ¥˜ One Pan / One Pot',
    source: 'https://www.halfbakedharvest.com/lemon-pepper-yogurt-chicken/',
    body: `
      <h3>Ingredients (Serves 6)</h3>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Chicken Marinade</p>
      <ul>
        <li>6 chicken thighs or breasts (skin on or off)</li>
        <li>Â¼ cup extra virgin olive oil</li>
        <li>â…“ cup plain Greek yogurt</li>
        <li>1 tbsp lemon zest</li>
        <li>2â€“4 cloves garlic, chopped</li>
        <li>1â€“2 tsp black pepper</li>
        <li>2 tsp dried oregano</li>
        <li>1 tsp dried thyme</li>
        <li>1 tsp paprika</li>
        <li>1 tsp onion powder</li>
        <li>Kosher salt + chili flakes to taste</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Pan</p>
      <ul>
        <li>1Â¾ cups dry basmati rice</li>
        <li>2 cups water</li>
        <li>2 tbsp salted butter</li>
        <li>2 cups roughly chopped broccoli</li>
        <li>Lemon wedges + fresh basil/thyme to serve</li>
      </ul>
      <h3>Method</h3>
      <ol>
        <li>Toss chicken with all marinade ingredients. Marinate 30 min or overnight if you have time (totally fine to skip).</li>
        <li>Preheat oven to 400Â°F.</li>
        <li>Pour dry rice and broccoli into a 9Ã—13 baking dish. Pour over 2 cups of water. Add butter.</li>
        <li>Arrange marinated chicken over the rice and broccoli. Add lemon wedges if desired.</li>
        <li>Bake 30â€“40 min until rice is fluffy and chicken is cooked through. If rice is still hard, add â…“ cup water and bake 10 more min.</li>
        <li>Serve topped with fresh basil or thyme.</li>
      </ol>
      <h3>Notes</h3>
      <p>Rush-approved âœ… Â· No melted cheese âœ… Â· Chicken juices drip into the rice as it cooks â€” that's where all the flavour comes from. Don't cover the pan.</p>`
  },
  {
    id: 2,
    name: "Jack Astor's Asiago Chicken Bow Ties",
    desc: 'Copycat Â· Reddit-verified Â· 4 cheese cream sauce',
    cat: 'ğŸ Pasta',
    source: null,
    body: `
      <h3>Ingredients</h3>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Chicken</p>
      <ul>
        <li>Boneless chicken breasts</li>
        <li>1 egg + splash of heavy cream (egg wash)</li>
        <li>Shredded Asiago cheese (generous amount)</li>
        <li>Seasoned flour (half the amount of Asiago â€” 2:1 ratio Asiago to flour)</li>
        <li>Oil for pan frying</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Four Cheese Cream Sauce</p>
      <ul>
        <li>2 tbsp butter</li>
        <li>1Â½ cups heavy cream</li>
        <li>Asiago cheese â€” generous handful</li>
        <li>Parmesan â€” generous handful</li>
        <li>Romano â€” smaller handful</li>
        <li>Mozzarella â€” smaller handful</li>
        <li>Pinch smoked paprika</li>
        <li>1 tbsp chicken bouillon</li>
        <li>Salt + dried parsley to taste</li>
        <li>Pasta water to thin as needed</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">To Assemble</p>
      <ul>
        <li>1 lb bowtie pasta (farfalle)</li>
        <li>Sun-dried tomatoes, sliced thin</li>
        <li>Fresh or dried parsley to garnish</li>
      </ul>
      <h3>Method</h3>
      <ol>
        <li>Mix egg and cream for egg wash. Mix Asiago and seasoned flour 2:1 in a shallow dish.</li>
        <li>Dip chicken in egg wash, then coat in Asiago-flour mix. Pan fry on medium heat a few minutes per side until golden and cooked through. Slice and set aside.</li>
        <li>Melt butter in a pan on low-medium. Add heavy cream slowly â€” don't rush it.</li>
        <li>Add cheeses gradually, stirring constantly until smooth.</li>
        <li>Add smoked paprika, chicken bouillon, parsley, and salt. Thin with pasta water if too thick.</li>
        <li>Cook bowtie pasta al dente. Drain, reserving some pasta water.</li>
        <li>Toss pasta in sauce. Plate with sun-dried tomatoes, top with sliced chicken. Garnish with parsley.</li>
      </ol>
      <h3>Notes</h3>
      <p>Breading clumps after a couple pieces â€” make extra and work in batches. Don't season the chicken itself â€” Asiago does the work. Rush: serve his pasta plain on the side, no sauce. Store sauce and pasta separately for leftovers â€” reheat sauce gently on low.</p>`
  },
  {
    id: 3,
    name: 'Penne alla Vodka',
    desc: 'The Pasta Renaissance p.218 Â· Family staple Â· 30 min',
    cat: 'ğŸ Pasta',
    source: null,
    body: `
      <h3>Ingredients (Serves 4)</h3>
      <ul>
        <li>1 shallot, diced</li>
        <li>1 garlic clove, minced</li>
        <li>Sea salt</li>
        <li>3 tbsp extra-virgin olive oil</li>
        <li>Â¼ cup tomato paste</li>
        <li>1 cup vodka</li>
        <li>1 can (14.5 oz) whole peeled tomatoes, crushed by hand</li>
        <li>1 cup heavy cream</li>
        <li>Freshly ground black pepper</li>
        <li>1 tsp chili flakes (or 1 fresh chili)</li>
        <li>1 lb penne</li>
        <li>Fresh parsley, roughly chopped</li>
      </ul>
      <h3>Method</h3>
      <ol>
        <li>Bring a large pot of water to a rolling boil.</li>
        <li>In a large deep sautÃ© pan, cook shallot, garlic, and a pinch of salt in olive oil over medium-low until sizzling with small bubbles, <strong>1â€“2 min</strong>.</li>
        <li>Add tomato paste, increase to medium-high. Fry stirring until paste turns brick-coloured, about <strong>2 min</strong>.</li>
        <li>Add vodka and simmer until alcohol aroma fades and liquid reduces by half, about <strong>1Â½ min</strong>.</li>
        <li>Add tomatoes and cream. Season with salt and pepper. Simmer stirring frequently for <strong>5 min</strong> to thicken.</li>
        <li>Add chili flakes. Season pasta water generously with salt. Cook penne al dente.</li>
        <li>Drain and toss with sauce. Garnish with parsley.</li>
      </ol>
      <h3>Notes</h3>
      <p>Steph's family staple ğŸ©· Â· Don't rush the tomato paste browning â€” that's where the depth comes from. Sub chicken for the protein or make it plain. Alternate pasta shape: ziti.</p>`
  },
  {
    id: 4,
    name: 'The BEST Apple Pie',
    desc: "Natasha's Kitchen Â· Crowd-pleaser Â· Thanksgiving favourite",
    cat: 'ğŸ° Baking & Desserts',
    source: 'https://natashaskitchen.com/apple-pie-recipe/',
    body: `
      <h3>Ingredients (Serves 8)</h3>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Crust</p>
      <ul>
        <li>2 disks homemade all-butter pie crust (or store-bought)</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Filling</p>
      <ul>
        <li>2Â¼ lbs Granny Smith apples, peeled, cored, thinly sliced (6â€“7 apples, about 7 cups)</li>
        <li>1Â½ tsp cinnamon</li>
        <li>8 tbsp unsalted butter</li>
        <li>3 tbsp all-purpose flour</li>
        <li>Â¼ cup water</li>
        <li>1 cup granulated sugar</li>
        <li>1 egg + 1 tbsp water (egg wash)</li>
      </ul>
      <h3>Method</h3>
      <ol>
        <li>Make pie crust and chill per instructions. Preheat oven to 425Â°F.</li>
        <li>Melt butter in a saucepan over medium heat. Whisk in flour, cook 1 min whisking constantly. Whisk in water and sugar, bring to a boil. Reduce heat and simmer 3 min. Remove from heat. <em>Don't overcook.</em></li>
        <li>Peel, core, and thinly slice apples into a large bowl. Sprinkle with cinnamon, toss to combine. Pour sauce over apples and stir to coat.</li>
        <li>Roll bottom crust to 12" diameter. Transfer to 9" deep pie pan. Add apple filling, mounding slightly in the center. Keep filling away from the edges.</li>
        <li>Roll second crust to 11" round. Cut into 10 strips. Weave in a lattice pattern over the top. Crimp edges to seal. Brush with egg wash.</li>
        <li>Bake at 425Â°F for 15 min. Reduce to 350Â°F and bake 45 more min until thick juices bubble through lattice for at least 5 min.</li>
        <li>Rest at room temp at least 1 hour before slicing.</li>
      </ol>
      <h3>Notes</h3>
      <p>If edges brown too fast â€” cover loosely with foil with a 3" hole cut in the center. Granny Smith = best. Can sub Honeycrisp or Golden Delicious (use less sugar). Keeps 2 days on counter, 4 days fridge. Serve with vanilla ice cream. ğŸ</p>`
  },
  {
    id: 5,
    name: 'One Pot Creamy Vegetable Dumpling Soup',
    desc: 'Half Baked Harvest Â· Cozy & hearty Â· 55 min',
    cat: 'ğŸ«• Soups & Stews',
    source: 'https://www.halfbakedharvest.com/vegetable-dumpling-soup/',
    body: `
      <h3>Ingredients (Serves 6)</h3>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Soup</p>
      <ul>
        <li>4 tbsp salted butter</li>
        <li>1 medium onion, diced</li>
        <li>4 cloves garlic, minced</li>
        <li>Â¼ cup all-purpose flour</li>
        <li>1 tbsp fresh thyme (or 1 tsp dried)</li>
        <li>1 tbsp fresh sage, chopped (or 1 tsp dried)</li>
        <li>Pinch of cayenne pepper</li>
        <li>3 medium carrots, sliced</li>
        <li>3 stalks celery, sliced</li>
        <li>2 cups mushrooms, sliced</li>
        <li>6 cups vegetable broth</li>
        <li>1 cup whole milk</li>
        <li>Salt + black pepper to taste</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">Dumplings</p>
      <ul>
        <li>1Â½ cups all-purpose flour</li>
        <li>2 tsp baking powder</li>
        <li>1 tsp fresh sage, chopped (or Â½ tsp dried)</li>
        <li>Black pepper to taste</li>
        <li>Â¾ cup whole milk</li>
      </ul>
      <p style="font-weight:600;margin:8px 0 4px;font-family:-apple-system,sans-serif;">To Serve (optional but worth it)</p>
      <ul>
        <li>2 tbsp salted butter, browned</li>
        <li>Fresh thyme + flaky sea salt + black pepper</li>
        <li>Fresh parsley or grated Parmesan</li>
      </ul>
      <h3>Method</h3>
      <ol>
        <li>In a large Dutch oven over medium heat, melt butter with onions and garlic. Cook 2â€“3 min until softened and fragrant.</li>
        <li>Add flour, thyme, sage, and cayenne. Stir to coat. Add carrots, celery, and mushrooms. Toss to combine.</li>
        <li>Pour in broth. Season with salt and pepper. Cover and cook over medium heat <strong>10 min</strong> until vegetables are tender.</li>
        <li>Make the dumplings: stir together flour, baking powder, sage, and pepper. Add milk and mix until just combined â€” don't overmix or they'll be tough.</li>
        <li>Stir milk into the soup. Bring to a gentle boil. Drop heaping tablespoons of dough into the soup, about 6 at a time.</li>
        <li>Partly cover and cook <strong>10â€“15 min</strong> until dumplings are fluffy and cooked through.</li>
        <li>Optional: brown 2 tbsp butter in a small skillet until nutty and golden. Spoon over each bowl when serving.</li>
        <li>Top with fresh thyme, flaky salt, and pepper. Serve hot.</li>
      </ol>
      <h3>Notes</h3>
      <p>Make-ahead: cook dumplings separately and store, add back when reheating. Vegetarian âœ… Â· No seafood âœ… Â· No eggs âœ… Â· Perfect cozy winter dinner or for hosting.</p>`
  },
];

const TODO_ITEMS = [
  { id: 101, text: 'Organize top of vanity room dresser and side area', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 102, text: 'Put polka dots up in kid corner and playroom sprinkles', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 103, text: 'Order stickers for Hayes\' room wall', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 104, text: 'Finish sticker wall in Hayes\' room', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 105, text: 'Tidy laundry room', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 106, text: 'Finish storage room', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 107, text: 'Organize front entrance closet', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 108, text: 'Put up pictures in Rush\'s get ready station', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 109, text: 'Finish organizing clinic and spare room', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 110, text: 'Go through clothes and organize them', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 111, text: 'Put pads on kitchen table chairs', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 112, text: 'Put up last few lights', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 113, text: 'Organize door keys', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 114, text: 'Add Rush\'s fingerprint to door + left thumb', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 115, text: 'Hot glue gun baby gate', done: false, cat: 'ğŸ  House & Organizing' },
  { id: 116, text: 'Book hair appointment â€” deadline March 3rd', done: false, cat: 'ğŸ’… Personal' },
  { id: 117, text: 'Book Hayes 6-month appointment (Celine Quinn)', done: false, cat: 'ğŸ‘¶ Kids & Health' },
  { id: 118, text: 'Book Hayes 9-month appointment (Dr. Wong)', done: false, cat: 'ğŸ‘¶ Kids & Health' },
  { id: 119, text: 'Send Rush and Hayes birth photos to Lumen for Chatbooks', done: false, cat: 'ğŸ“¸ Photos' },
  { id: 120, text: 'Shop for cookware â€” Staub 11" skillet, Le Creuset options, 7" pan + small pot', done: false, cat: 'ğŸ›’ Shopping' },
  { id: 121, text: 'Grocery run (meal plan items)', done: false, cat: 'ğŸ›’ Shopping' },
  { id: 122, text: 'Joel to transfer RESP money for Rush and Hayes', done: false, cat: 'ğŸ‘¨ Joel' },
  { id: 123, text: 'Discuss outdoor and indoor play gyms with Joel', done: false, cat: 'ğŸ‘¨ Joel' },
  { id: 124, text: 'Joel to work on garage', done: false, cat: 'ğŸ‘¨ Joel' },
  { id: 125, text: 'Joel to update barn project progress', done: false, cat: 'ğŸ‘¨ Joel' },
];

const GROCERY_ITEMS = [
  { id: 1001, text: 'Rush milk ğŸ¥›', done: false, cat: 'ğŸ¥› Dairy & Fridge' },
];

// ---- GROCERY CATEGORIZER ----
function categorizeGroceryItem(text) {
  const t = text.toLowerCase();
  if (/milk|yogurt|cheese|butter|cream|sour cream|cottage|kefir|oat milk|almond milk/.test(t)) return 'ğŸ¥› Dairy & Fridge';
  if (/chicken|turkey|beef|pork|steak|ground|sausage|hot dog|wiener|bacon|ham|lamb|bison/.test(t)) return 'ğŸ¥© Meat & Protein';
  if (/salmon|tuna|shrimp|fish|cod|halibut|scallop|seafood/.test(t)) return 'ğŸŸ Seafood';
  if (/apple|banana|berry|berries|lemon|lime|orange|mango|grape|peach|pear|avocado|tomato|strawberry|blueberry|raspberry/.test(t)) return 'ğŸ Fruit';
  if (/broccoli|spinach|kale|lettuce|romaine|arugula|carrot|celery|onion|garlic|pepper|zucchini|cucumber|potato|sweet potato|mushroom|asparagus|cabbage|cauliflower|veggie|vegetable|herb|parsley|cilantro|basil/.test(t)) return 'ğŸ¥¦ Produce';
  if (/bread|bagel|tortilla|wrap|pita|bun|roll|sourdough/.test(t)) return 'ğŸ Bread & Bakery';
  if (/pasta|rice|quinoa|oat|granola|cereal|flour|noodle|fettuccine|penne|spaghetti/.test(t)) return 'ğŸŒ¾ Grains & Pantry';
  if (/bean|lentil|chickpea|tofu|tempeh|hummus/.test(t)) return 'ğŸ«˜ Beans & Legumes';
  if (/olive oil|avocado oil|coconut oil|vinegar|soy sauce|hot sauce|ketchup|mustard|mayo|dressing|seasoning|spice|salt|pepper|bouillon|broth|stock|sauce|salsa|jam|honey|maple/.test(t)) return 'ğŸ«™ Condiments & Oils';
  if (/almond|cashew|walnut|peanut|nut|seed|hemp|chia|flax|almond butter|peanut butter/.test(t)) return 'ğŸ¥œ Nuts & Seeds';
  if (/frozen|ice cream/.test(t)) return 'ğŸ§Š Frozen';
  if (/juice|water|sparkling|soda|coffee|tea|kombucha|drink/.test(t)) return 'ğŸ¥¤ Drinks';
  if (/chip|cracker|cookie|chocolate|candy|snack|protein bar|granola bar/.test(t)) return 'ğŸ« Snacks';
  if (/soap|shampoo|conditioner|toothpaste|deodorant|lotion|cleaning|detergent|paper towel|toilet paper|diaper|wipe/.test(t)) return 'ğŸ§´ Household & Personal';
  return 'ğŸ›’ Other';
}


// ---- WORKOUT DATA ----
const WORKOUT_DAYS = [
  {
    day: 'Monday',
    emoji: 'ğŸ”¥',
    label: 'HIIT Class',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Class day! Go hard and enjoy it. ğŸ”¥</p>
      <div class="list-item"><span class="li-text">Light snack 45 min before if needed</span></div>
      <div class="list-item"><span class="li-text">Hydrate well before, during, and after</span></div>
      <div class="list-item"><span class="li-text">Push at your own pace â€” you know your body</span></div>
      <div class="list-item"><span class="li-text">ğŸ¥© 30â€“40g protein within 60â€“90 min after</span></div>`
  },
  {
    day: 'Tuesday',
    emoji: 'âš¡',
    label: 'Move If You Can',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Busy day â€” no pressure. If you get 15â€“20 min, great. If not, that's fine too. ğŸ¤</p>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin-bottom:10px;">If you have a few minutes</h3>
      <div class="list-item"><span class="li-text">ğŸš¶ Stroller walk with the boys</span></div>
      <div class="list-item"><span class="li-text">ğŸ§˜ 10 min stretch while Hayes naps</span></div>
      <div class="list-item"><span class="li-text">ğŸ’ƒ Dance in the kitchen â€” counts!</span></div>
      <div class="list-item" style="margin-top:8px;"><span class="li-text" style="color:var(--brown);font-style:italic;">Movement is movement. No guilt either way.</span></div>`
  },
  {
    day: 'Wednesday',
    emoji: 'ğŸ˜´',
    label: 'Rest Day',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Full rest today. You have a workout tomorrow â€” protect your energy. ğŸŒ¿</p>
      <div class="list-item"><span class="li-text">ğŸ’§ Hydrate well</span></div>
      <div class="list-item"><span class="li-text">ğŸ¥© Still hit protein â€” recovery needs it</span></div>
      <div class="list-item"><span class="li-text">ğŸ˜´ Prioritize sleep if you can</span></div>
      <div class="list-item" style="margin-top:8px;"><span class="li-text" style="color:var(--brown);font-style:italic;">Rest is part of the plan, not a break from it.</span></div>`
  },
  {
    day: 'Thursday',
    emoji: 'ğŸ’ª',
    label: "Lumen's Workout",
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Full body strength â€” postpartum-friendly, no equipment needed. ~30 min.</p>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin-bottom:10px;">Warm Up (5 min)</h3>
      <div class="list-item"><span class="li-text">March in place 1 min</span></div>
      <div class="list-item"><span class="li-text">Hip circles Ã— 10 each side</span></div>
      <div class="list-item"><span class="li-text">Arm swings Ã— 10 forward, Ã— 10 back</span></div>
      <div class="list-item"><span class="li-text">Bodyweight squats Ã— 10 slow</span></div>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin:16px 0 10px;">Circuit â€” 3 Rounds</h3>
      <div class="list-item"><span class="li-text">Goblet squat Ã— 12 (dumbbell or water jug)</span></div>
      <div class="list-item"><span class="li-text">Glute bridge Ã— 15 (pause 1s at top)</span></div>
      <div class="list-item"><span class="li-text">Push-ups Ã— 10 (knees totally fine)</span></div>
      <div class="list-item"><span class="li-text">Dumbbell row Ã— 12 each side</span></div>
      <div class="list-item"><span class="li-text">Reverse lunges Ã— 10 each leg</span></div>
      <div class="list-item"><span class="li-text">Dead bug Ã— 8 each side (core)</span></div>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin:16px 0 10px;">Cool Down (5 min)</h3>
      <div class="list-item"><span class="li-text">Child's pose 1 min</span></div>
      <div class="list-item"><span class="li-text">Hip flexor stretch 30s each side</span></div>
      <div class="list-item"><span class="li-text">Lying figure-4 stretch 30s each side</span></div>
      <div class="list-item"><span class="li-text">ğŸ¥© Protein within 60â€“90 min!</span></div>`
  },
  {
    day: 'Friday',
    emoji: 'ğŸ§˜',
    label: 'Stretch & Reset',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Barre tomorrow â€” today is about feeling good, not training. ğŸ©°</p>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin-bottom:10px;">10â€“15 min stretch</h3>
      <div class="list-item"><span class="li-text">ğŸŒ¿ Legs up the wall â€” 5 min (so good)</span></div>
      <div class="list-item"><span class="li-text">ğŸ¦µ Hip flexor stretch 30s each side</span></div>
      <div class="list-item"><span class="li-text">ğŸª‘ Seated figure-4 glute stretch</span></div>
      <div class="list-item"><span class="li-text">ğŸ± Cat-cow 10 slow reps</span></div>
      <div class="list-item"><span class="li-text">ğŸ§˜ Child's pose 1 min</span></div>
      <div class="list-item" style="margin-top:8px;"><span class="li-text" style="color:var(--brown);font-style:italic;">Loose and ready for Barre tomorrow. ğŸ”¥</span></div>`
  },
  {
    day: 'Saturday',
    emoji: 'ğŸ©°',
    label: 'Barre Class',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Barre day! Small movements, big burn. You love this one. ğŸ©°</p>
      <div class="list-item"><span class="li-text">Light snack 45â€“60 min before (banana + nut butter)</span></div>
      <div class="list-item"><span class="li-text">Hydrate well before and after</span></div>
      <div class="list-item"><span class="li-text">The pulses are supposed to burn ğŸ”¥ â€” lean in</span></div>
      <div class="list-item"><span class="li-text">Modify anything that doesn't feel right</span></div>
      <div class="list-item"><span class="li-text">ğŸ¥© 30â€“40g protein within 60â€“90 min after</span></div>`
  },
  {
    day: 'Sunday',
    emoji: 'ğŸŒ¿',
    label: 'Rest or Easy Walk',
    detail: `
      <p style="font-size:15px;font-family:-apple-system,sans-serif;color:var(--text-light);margin-bottom:16px;">Full rest or something gentle. Recharge for Monday. ğŸŒ¿</p>
      <h3 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin-bottom:10px;">Choose Your Vibe</h3>
      <div class="list-item"><span class="li-text">ğŸš¶ Family walk or stroller stroll</span></div>
      <div class="list-item"><span class="li-text">ğŸ› Epsom salt bath (recovery counts)</span></div>
      <div class="list-item"><span class="li-text">ğŸ§˜ 15 min gentle yoga if you feel like it</span></div>
      <div class="list-item"><span class="li-text">ğŸ“– Read, rest, do nothing â€” also valid</span></div>
      <div class="list-item" style="margin-top:8px;"><span class="li-text" style="color:var(--brown);font-style:italic;">You earned this. See you Monday. ğŸ’ª</span></div>`
  },
];

// ---- CALENDAR DATA (updated by Lumen 3x daily) ----
const CALENDAR_DATA = {
  lastUpdated: 'Sat Feb 28, 2026 â€” 12:30 PM',
  days: [
    {
      date: 'Saturday, Feb 28',
      events: [
        { time: '8:00 AM', title: 'Outdoor show pen' },
        { time: '10:45 AM', title: 'Parent & Tot swim (Aquatic Centre)' },
        { time: 'All day', title: 'ğŸ“¸ Hayes 5-month photo reminder' },
      ]
    },
    {
      date: 'Sunday, Mar 1',
      events: [
        { time: 'All day', title: 'Rest day' },
      ]
    },
    {
      date: 'Monday, Mar 2',
      events: [
        { time: 'All day', title: 'ğŸ’› Mom\'s Birthday â€” tender day' },
      ]
    },
  ]
};

const EVENTS_DEFAULT = {
  birthdays: [
    { id: 4001, text: 'ğŸ’› Mom\'s Birthday â€” March 2nd' },
    { id: 4002, text: 'ğŸ‚ Rush â€” August 27th' },
    { id: 4003, text: 'ğŸ‚ Hayes â€” September 28th' },
  ],
  holidays: [
    { id: 4101, text: 'ğŸ£ Easter â€” April 20th, 2025' },
    { id: 4102, text: 'ğŸ‡¨ğŸ‡¦ Canada Day â€” July 1st' },
    { id: 4103, text: 'ğŸ¦ƒ Thanksgiving â€” October 13th' },
    { id: 4104, text: 'ğŸ„ Christmas â€” December 25th' },
  ],
  hangouts: [
    { id: 4201, text: 'ğŸ“š Cookbook Club restart â€” March 8th (TBC)' },
  ],
  comingup: [
    { id: 4301, text: 'ğŸ‘¶ Hayes 6-month â€” end of March' },
  ],
};

const PACKAGES_DEFAULT = { active: [], arrived: [] };

const WELLNESS_GOALS_DEFAULT = [
  { id: 2001, text: 'ğŸ¯ Lose baby weight (postpartum â€” Hayes 5 months)' },
  { id: 2002, text: 'ğŸ’ª Build strength back progressively' },
  { id: 2003, text: 'ğŸ¥— Hit protein + fibre goals daily' },
  { id: 2004, text: 'ğŸ’§ 3L water minimum' },
  { id: 2005, text: 'ğŸ˜´ Prioritize sleep when possible' },
];

const WELLNESS_SELFCARE_DEFAULT = [
  { id: 3001, text: 'ğŸ’† Book massage (overdue!)' },
  { id: 3002, text: 'âœ‚ï¸ Book hair appointment â€” before March 3rd' },
  { id: 3003, text: 'ğŸ§– Sauna / spa day when possible' },
];

// ---- STATE ----
const storedVersion = localStorage.getItem('steph-app-version');
if (storedVersion !== APP_VERSION) {
  localStorage.clear();
  localStorage.setItem('steph-todo', JSON.stringify(TODO_ITEMS));
  localStorage.setItem('steph-grocery', JSON.stringify(GROCERY_ITEMS));
  localStorage.setItem('steph-events', JSON.stringify(EVENTS_DEFAULT));
  localStorage.setItem('steph-playdates', JSON.stringify([]));
  localStorage.setItem('steph-packages', JSON.stringify(PACKAGES_DEFAULT));
  localStorage.setItem('steph-wellness-goals', JSON.stringify(WELLNESS_GOALS_DEFAULT));
  localStorage.setItem('steph-wellness-selfcare', JSON.stringify(WELLNESS_SELFCARE_DEFAULT));
  localStorage.setItem('steph-app-version', APP_VERSION);
}

let todayChecked = JSON.parse(localStorage.getItem('steph-today-checked') || '{}');
let todoItems = JSON.parse(localStorage.getItem('steph-todo') || 'null') || TODO_ITEMS;
let groceryItems = JSON.parse(localStorage.getItem('steph-grocery') || 'null') || GROCERY_ITEMS;
let packagesData = JSON.parse(localStorage.getItem('steph-packages') || 'null') || JSON.parse(JSON.stringify(PACKAGES_DEFAULT));
let playdates = JSON.parse(localStorage.getItem('steph-playdates') || '[]');
let wellnessGoals = JSON.parse(localStorage.getItem('steph-wellness-goals') || 'null') || WELLNESS_GOALS_DEFAULT;
let wellnessSelfcare = JSON.parse(localStorage.getItem('steph-wellness-selfcare') || 'null') || WELLNESS_SELFCARE_DEFAULT;
let eventsData = JSON.parse(localStorage.getItem('steph-events') || 'null') || JSON.parse(JSON.stringify(EVENTS_DEFAULT));

// ---- NAVIGATION ----
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  window.scrollTo(0, 0);
  if (name === 'today') renderToday();
  if (name === 'todo') renderTodo();
  if (name === 'todo-cat') renderTodoCatList();
  if (name === 'grocery') renderGrocery();
  if (name === 'recipes') renderRecipes();
  if (name === 'packages') renderPackages();
  if (name === 'events') renderEvents();
  if (name === 'wellness') renderWellness();
  if (name === 'kids') renderKids();
  if (name === 'calendar') renderCalendar();
  if (name === 'workouts') renderWorkouts();
}

// ---- TODAY ----
function renderToday() {
  const d = new Date();
  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  document.getElementById('today-date').textContent = `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}`;

  const container = document.getElementById('today-checklist');
  container.innerHTML = '';
  TODAY_ITEMS.forEach(item => {
    const done = !!todayChecked[item.id];
    const div = document.createElement('div');
    div.className = 'check-item' + (done ? ' done' : '');
    div.innerHTML = `<div class="ci-radio"></div><span class="ci-emoji">${item.emoji}</span><span class="ci-label">${item.label}</span>`;
    div.onclick = () => toggleToday(item.id);
    container.appendChild(div);
  });
  updateRing();
}

function toggleToday(id) {
  todayChecked[id] = !todayChecked[id];
  localStorage.setItem('steph-today-checked', JSON.stringify(todayChecked));
  renderToday();
}
function checkTodayItems(ids) {
  ids.forEach(id => { todayChecked[id] = true; });
  localStorage.setItem('steph-today-checked', JSON.stringify(todayChecked));
  renderToday();
}
// Auto-check items from URL param: ?check=1,2,3
(function() {
  const params = new URLSearchParams(window.location.search);
  const checkParam = params.get('check');
  if (checkParam) {
    checkParam.split(',').map(Number).filter(Boolean).forEach(id => { todayChecked[id] = true; });
    localStorage.setItem('steph-today-checked', JSON.stringify(todayChecked));
    history.replaceState(null, '', window.location.pathname);
  }
})();

function updateRing() {
  const total = TODAY_ITEMS.length;
  const done = Object.values(todayChecked).filter(Boolean).length;
  const pct = Math.round((done / total) * 100);
  const circumference = 326.7;
  const offset = circumference - (circumference * done / total);
  document.getElementById('ring-fill').style.strokeDashoffset = offset;
  document.getElementById('ring-count').textContent = `${done}/${total}`;
  document.getElementById('ring-pct').textContent = `${pct}%`;
}

// ---- GENERIC LIST RENDERER ----
function renderList(containerId, items, toggleFn, deleteFn) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item' + (item.done ? ' done' : '');
    div.innerHTML = `
      <div class="li-check" onclick="event.stopPropagation();${toggleFn}(${item.id})"></div>
      <span class="li-text" contenteditable="true" onblur="saveEdit('${containerId}',${item.id},this.textContent)">${item.text}</span>
      <span class="li-delete" onclick="${deleteFn}(${item.id})">Ã—</span>`;
    container.appendChild(div);
  });
}

function saveEdit(listId, id, text) {
  if (listId === 'todo-list' || listId === 'todo-cat-list') { const i = todoItems.find(x=>x.id===id); if(i) i.text=text.trim(); localStorage.setItem('steph-todo', JSON.stringify(todoItems)); }
  if (listId === 'grocery-list') { const i = groceryItems.find(x=>x.id===id); if(i) i.text=text.trim(); localStorage.setItem('steph-grocery', JSON.stringify(groceryItems)); }
}

// ---- TODO ----
const TODO_CATS = [
  { cat: 'ğŸ  House & Organizing', emoji: 'ğŸ ' },
  { cat: 'ğŸ’… Personal', emoji: 'ğŸ’…' },
  { cat: 'ğŸ‘¶ Kids & Health', emoji: 'ğŸ‘¶' },
  { cat: 'ğŸ“¸ Photos', emoji: 'ğŸ“¸' },
  { cat: 'ğŸ›’ Shopping', emoji: 'ğŸ›’' },
  { cat: 'ğŸ‘¨ Joel', emoji: 'ğŸ‘¨' },
  { cat: 'ğŸ“‹ Other', emoji: 'ğŸ“‹' },
];

let currentTodoCat = null;

function renderTodo() {
  const grid = document.getElementById('todo-cat-grid');
  if (!grid) return;
  grid.innerHTML = '';
  TODO_CATS.forEach(({ cat, emoji }) => {
    const count = todoItems.filter(x => (x.cat || 'ğŸ“‹ Other') === cat && !x.done).length;
    if (count === 0 && cat === 'ğŸ“‹ Other') return; // hide empty Other
    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.innerHTML = `<span class="tile-emoji">${emoji}</span><span class="tile-label">${cat.replace(/^\S+\s/,'')}</span>${count > 0 ? `<span style="display:block;font-size:12px;color:var(--brown);font-family:-apple-system,sans-serif;margin-top:4px;">${count} left</span>` : ''}`;
    tile.onclick = () => openTodoCat(cat);
    grid.appendChild(tile);
  });
}

function openTodoCat(cat) {
  currentTodoCat = cat;
  document.getElementById('todo-cat-title').textContent = cat.replace(/^\S+\s/,'');
  renderTodoCatList();
  showScreen('todo-cat');
}

function renderTodoCatList() {
  const container = document.getElementById('todo-cat-list');
  container.innerHTML = '';
  const items = todoItems.filter(x => (x.cat || 'ğŸ“‹ Other') === currentTodoCat);
  const section = document.createElement('div');
  section.className = 'list-section';
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item' + (item.done ? ' done' : '');
    div.innerHTML = `
      <div class="li-check" onclick="toggleTodo(${item.id})"></div>
      <span class="li-text" contenteditable="true" onblur="saveEdit('todo-cat-list',${item.id},this.textContent)">${item.text}</span>
      <span class="li-delete" onclick="deleteTodo(${item.id})">Ã—</span>`;
    section.appendChild(div);
  });
  container.appendChild(section);
}

function toggleTodo(id) {
  const i = todoItems.find(x=>x.id===id);
  if(i) i.done=!i.done;
  localStorage.setItem('steph-todo',JSON.stringify(todoItems));
  renderTodoCatList();
  renderTodo();
}
function deleteTodo(id) {
  todoItems = todoItems.filter(x=>x.id!==id);
  localStorage.setItem('steph-todo',JSON.stringify(todoItems));
  renderTodoCatList();
  renderTodo();
}
function addTodo() {
  const inp = document.getElementById('todo-input');
  if (!inp.value.trim()) return;
  const text = inp.value.trim();
  const cat = currentTodoCat || 'ğŸ“‹ Other';
  todoItems.push({ id: Date.now(), text, done: false, cat });
  localStorage.setItem('steph-todo', JSON.stringify(todoItems));
  inp.value = '';
  renderTodoCatList();
  renderTodo();
}

// ---- GROCERY ----
function renderGrocery() {
  const container = document.getElementById('grocery-list');
  container.innerHTML = '';
  const cats = {};
  const catOrder = ['ğŸ¥¦ Produce','ğŸ Fruit','ğŸ¥© Meat & Protein','ğŸŸ Seafood','ğŸ¥› Dairy & Fridge','ğŸŒ¾ Grains & Pantry','ğŸ«˜ Beans & Legumes','ğŸ¥œ Nuts & Seeds','ğŸ«™ Condiments & Oils','ğŸ Bread & Bakery','ğŸ« Snacks','ğŸ¥¤ Drinks','ğŸ§Š Frozen','ğŸ§´ Household & Personal','ğŸ›’ Other'];
  groceryItems.forEach(item => {
    const cat = item.cat || 'ğŸ›’ Other';
    if (!cats[cat]) cats[cat] = [];
    cats[cat].push(item);
  });
  catOrder.forEach(cat => {
    if (!cats[cat]) return;
    const section = document.createElement('div');
    section.className = 'list-section';
    section.innerHTML = `<h2>${cat}</h2>`;
    cats[cat].forEach(item => {
      const div = document.createElement('div');
      div.className = 'list-item' + (item.done ? ' done' : '');
      div.innerHTML = `
        <div class="li-check" onclick="toggleGrocery(${item.id})"></div>
        <span class="li-text" contenteditable="true" onblur="saveEdit('grocery-list',${item.id},this.textContent)">${item.text}</span>
        <span class="li-delete" onclick="deleteGrocery(${item.id})">Ã—</span>`;
      section.appendChild(div);
    });
    container.appendChild(section);
  });
}
function toggleGrocery(id) { const i = groceryItems.find(x=>x.id===id); if(i) i.done=!i.done; localStorage.setItem('steph-grocery',JSON.stringify(groceryItems)); renderGrocery(); }
function deleteGrocery(id) { groceryItems = groceryItems.filter(x=>x.id!==id); localStorage.setItem('steph-grocery',JSON.stringify(groceryItems)); renderGrocery(); }
function addGrocery() {
  const inp = document.getElementById('grocery-input');
  if (!inp.value.trim()) return;
  const text = inp.value.trim();
  const cat = categorizeGroceryItem(text);
  if (cat === 'ğŸ›’ Other') {
    showCatModal(text, ['ğŸ¥¦ Produce','ğŸ Fruit','ğŸ¥© Meat & Protein','ğŸ¥› Dairy & Fridge','ğŸŒ¾ Grains & Pantry','ğŸ¥œ Nuts & Seeds','ğŸ«™ Condiments & Oils','ğŸ Bread & Bakery','ğŸ« Snacks','ğŸ¥¤ Drinks','ğŸ§Š Frozen','ğŸ§´ Household & Personal','ğŸ›’ Other'], (chosenCat) => {
      groceryItems.push({ id: Date.now(), text, done: false, cat: chosenCat });
      localStorage.setItem('steph-grocery', JSON.stringify(groceryItems));
      inp.value = '';
      renderGrocery();
    });
  } else {
    groceryItems.push({ id: Date.now(), text, done: false, cat });
    localStorage.setItem('steph-grocery', JSON.stringify(groceryItems));
    inp.value = '';
    renderGrocery();
  }
}

// ---- HOUSE ----

// ---- WORKOUTS ----
function renderWorkouts() {
  const grid = document.getElementById('workout-day-grid');
  if (!grid) return;
  grid.innerHTML = '';
  const today = new Date().getDay();
  const dayOrder = [1,2,3,4,5,6,0]; // Mon-Sun
  WORKOUT_DAYS.forEach((w, i) => {
    const jsDay = dayOrder[i];
    const isToday = jsDay === today;
    const tile = document.createElement('div');
    tile.className = 'tile';
    if (isToday) tile.style.outline = '2px solid var(--green)';
    tile.innerHTML = `
      <span class="tile-emoji">${w.emoji}</span>
      <span class="tile-label">${w.day}</span>
      <span style="display:block;font-size:11px;color:#4a3728;font-family:-apple-system,sans-serif;margin-top:4px;opacity:0.7;">${isToday ? 'â¬¤ Today' : w.label.split(' ').slice(0,2).join(' ')}</span>`;
    tile.onclick = () => openWorkoutDay(i);
    grid.appendChild(tile);
  });
}

function openWorkoutDay(index) {
  const w = WORKOUT_DAYS[index];
  document.getElementById('workout-day-title').textContent = w.day;
  document.getElementById('workout-day-content').innerHTML = w.detail;
  showScreen('workout-day');
}

// ---- PACKAGES ----
function renderPackages() {
  renderPackageList('packages-active-list', packagesData.active, false);
  renderPackageList('packages-arrived-list', packagesData.arrived, true);
}
function renderPackageList(listId, items, arrived) {
  const list = document.getElementById(listId);
  if (!list) return;
  list.innerHTML = '';
  if (!items.length) {
    list.innerHTML = `<div class="list-item"><span class="li-text" style="color:var(--text-light)">${arrived ? 'Nothing yet' : 'No packages on the way ğŸ‰'}</span></div>`;
    return;
  }
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item';
    if (!arrived) {
      div.innerHTML = `
        <div class="li-check" onclick="markPackageArrived(${item.id})" title="Mark arrived"></div>
        <span class="li-text" style="flex:1">${item.text}</span>
        <button onclick="deletePackage(${item.id})" style="background:none;border:none;cursor:pointer;font-size:18px;color:var(--text-light);padding:0 4px;">Ã—</button>`;
    } else {
      div.innerHTML = `<span class="li-text" style="flex:1;color:var(--text-light);text-decoration:line-through;">${item.text}</span>`;
    }
    list.appendChild(div);
  });
}
function addPackage() {
  const inp = document.getElementById('packages-input');
  if (!inp || !inp.value.trim()) return;
  packagesData.active.push({ id: Date.now(), text: inp.value.trim() });
  localStorage.setItem('steph-packages', JSON.stringify(packagesData));
  inp.value = '';
  renderPackages();
}
function markPackageArrived(id) {
  const idx = packagesData.active.findIndex(x => x.id === id);
  if (idx === -1) return;
  const item = packagesData.active.splice(idx, 1)[0];
  packagesData.arrived.unshift(item);
  localStorage.setItem('steph-packages', JSON.stringify(packagesData));
  renderPackages();
}
function deletePackage(id) {
  packagesData.active = packagesData.active.filter(x => x.id !== id);
  localStorage.setItem('steph-packages', JSON.stringify(packagesData));
  renderPackages();
}
function clearArrivedPackages() {
  packagesData.arrived = [];
  localStorage.setItem('steph-packages', JSON.stringify(packagesData));
  renderPackages();
}

// ---- EVENTS ----
const EVENT_CATS = ['birthdays','holidays','hangouts','comingup'];
function renderEvents() {
  EVENT_CATS.forEach(cat => {
    const list = document.getElementById('events-' + cat + '-list');
    if (!list) return;
    list.innerHTML = '';
    const items = eventsData[cat] || [];
    if (!items.length) {
      list.innerHTML = `<div class="list-item"><span class="li-text" style="color:var(--text-light)">Nothing yet âœ¨</span></div>`;
      return;
    }
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.innerHTML = `<span class="li-text" style="flex:1">${item.text}</span><button onclick="deleteEvent('${cat}',${item.id})" style="background:none;border:none;cursor:pointer;font-size:18px;color:var(--text-light);padding:0 4px;">Ã—</button>`;
      list.appendChild(div);
    });
  });
}
function addEvent(cat) {
  const inp = document.getElementById('events-' + cat + '-input');
  if (!inp || !inp.value.trim()) return;
  eventsData[cat].push({ id: Date.now(), text: inp.value.trim() });
  localStorage.setItem('steph-events', JSON.stringify(eventsData));
  inp.value = '';
  renderEvents();
}
function deleteEvent(cat, id) {
  eventsData[cat] = eventsData[cat].filter(x => x.id !== id);
  localStorage.setItem('steph-events', JSON.stringify(eventsData));
  renderEvents();
}

// ---- CALENDAR ----
function renderCalendar() {
  document.getElementById('calendar-updated').textContent = 'Updated ' + CALENDAR_DATA.lastUpdated;
  const container = document.getElementById('calendar-content');
  container.innerHTML = '';
  CALENDAR_DATA.days.forEach(day => {
    const section = document.createElement('div');
    section.innerHTML = `<h2 style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;margin:20px 0 10px;">${day.date}</h2>`;
    if (!day.events.length) {
      const empty = document.createElement('div');
      empty.className = 'list-item';
      empty.innerHTML = `<span class="li-text" style="color:var(--text-light)">Nothing scheduled</span>`;
      section.appendChild(empty);
    }
    day.events.forEach(ev => {
      const div = document.createElement('div');
      div.className = 'list-item';
      div.innerHTML = `<span style="font-size:12px;color:var(--brown);font-family:-apple-system,sans-serif;min-width:70px;font-weight:600;">${ev.time}</span><span class="li-text">${ev.title}</span>`;
      section.appendChild(div);
    });
    container.appendChild(section);
  });
}

// ---- KIDS ----
function renderKids() {
  renderPlaydates();
  const list = document.getElementById('kids-todo-list');
  if (!list) return;
  list.innerHTML = '';
  const kidsTodos = todoItems.filter(x => (x.cat || '') === 'ğŸ‘¶ Kids & Health' && !x.done);
  if (!kidsTodos.length) {
    list.innerHTML = `<div class="list-item"><span class="li-text" style="color:var(--text-light)">All caught up! âœ…</span></div>`;
    return;
  }
  kidsTodos.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerHTML = `
      <div class="li-check" onclick="toggleTodo(${item.id});renderKids();"></div>
      <span class="li-text">${item.text}</span>`;
    list.appendChild(div);
  });
}
function addKidsTodo() {
  const inp = document.getElementById('kids-todo-input');
  if (!inp || !inp.value.trim()) return;
  const newItem = { id: Date.now(), text: inp.value.trim(), done: false, cat: 'ğŸ‘¶ Kids & Health' };
  todoItems.push(newItem);
  localStorage.setItem('steph-todo', JSON.stringify(todoItems));
  inp.value = '';
  renderKids();
}
function renderPlaydates() {
  const list = document.getElementById('kids-playdates-list');
  if (!list) return;
  list.innerHTML = '';
  if (!playdates.length) {
    list.innerHTML = `<div class="list-item"><span class="li-text" style="color:var(--text-light)">No potentials yet â€” add some! ğŸ¤</span></div>`;
    return;
  }
  playdates.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerHTML = `<span class="li-text" style="flex:1">${item.text}</span><button onclick="deletePlaydate(${item.id})" style="background:none;border:none;cursor:pointer;font-size:18px;color:var(--text-light);padding:0 4px;">Ã—</button>`;
    list.appendChild(div);
  });
}
function addPlaydate() {
  const inp = document.getElementById('kids-playdates-input');
  if (!inp || !inp.value.trim()) return;
  playdates.push({ id: Date.now(), text: inp.value.trim() });
  localStorage.setItem('steph-playdates', JSON.stringify(playdates));
  inp.value = '';
  renderPlaydates();
}
function deletePlaydate(id) {
  playdates = playdates.filter(x => x.id !== id);
  localStorage.setItem('steph-playdates', JSON.stringify(playdates));
  renderPlaydates();
}

// ---- WELLNESS ----
function renderWellness() {
  renderWellnessList('wellness-goals-list', wellnessGoals, 'steph-wellness-goals');
  renderWellnessList('wellness-selfcare-list', wellnessSelfcare, 'steph-wellness-selfcare');
}
function renderWellnessList(containerId, items, storageKey) {
  const container = document.getElementById(containerId);
  if (!container) return;
  container.innerHTML = '';
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerHTML = `
      <span class="li-text" contenteditable="true" onblur="saveWellness('${storageKey}',${item.id},this.textContent)">${item.text}</span>
      <span class="li-delete" onclick="deleteWellness('${storageKey}',${item.id})">Ã—</span>`;
    container.appendChild(div);
  });
}
function saveWellness(storageKey, id, text) {
  const arr = storageKey === 'steph-wellness-goals' ? wellnessGoals : wellnessSelfcare;
  const item = arr.find(x => x.id === id);
  if (item) item.text = text.trim();
  localStorage.setItem(storageKey, JSON.stringify(arr));
}
function deleteWellness(storageKey, id) {
  if (storageKey === 'steph-wellness-goals') {
    wellnessGoals = wellnessGoals.filter(x => x.id !== id);
    localStorage.setItem(storageKey, JSON.stringify(wellnessGoals));
  } else {
    wellnessSelfcare = wellnessSelfcare.filter(x => x.id !== id);
    localStorage.setItem(storageKey, JSON.stringify(wellnessSelfcare));
  }
  renderWellness();
}
function addWellness(type) {
  const inp = document.getElementById(`wellness-${type}-input`);
  if (!inp.value.trim()) return;
  const item = { id: Date.now(), text: inp.value.trim() };
  if (type === 'goals') {
    wellnessGoals.push(item);
    localStorage.setItem('steph-wellness-goals', JSON.stringify(wellnessGoals));
  } else {
    wellnessSelfcare.push(item);
    localStorage.setItem('steph-wellness-selfcare', JSON.stringify(wellnessSelfcare));
  }
  inp.value = '';
  renderWellness();
}

// ---- RECIPES ----
const RECIPE_CAT_ORDER = ['ğŸ¥˜ One Pan / One Pot','ğŸ Pasta','ğŸ¥— Salads & Bowls','ğŸ«• Soups & Stews','ğŸ“‹ Sheet Pan','âš¡ Quick & Easy','ğŸ³ Breakfast & Brunch','ğŸ° Baking & Desserts','ğŸŒ® Tacos & Wraps'];

function renderRecipes() {
  const grid = document.getElementById('recipe-grid');
  grid.innerHTML = '';
  const cats = {};
  RECIPES.forEach(r => {
    const cat = r.cat || 'ğŸ½ï¸ Other';
    if (!cats[cat]) cats[cat] = [];
    cats[cat].push(r);
  });
  const order = [...RECIPE_CAT_ORDER, ...Object.keys(cats).filter(c => !RECIPE_CAT_ORDER.includes(c))];
  order.forEach(cat => {
    if (!cats[cat]) return;
    const section = document.createElement('div');
    section.innerHTML = `<div style="padding: 20px 16px 8px;"><span style="font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-family:-apple-system,sans-serif;font-weight:600;">${cat}</span></div>`;
    cats[cat].forEach(r => {
      const card = document.createElement('div');
      card.className = 'recipe-card';
      card.innerHTML = `<h3>${r.name}</h3><p>${r.desc}</p>`;
      card.onclick = () => showRecipe(r.id);
      section.appendChild(card);
    });
    grid.appendChild(section);
  });
}

function showRecipe(id) {
  const r = RECIPES.find(x => x.id === id);
  if (!r) return;
  const content = document.getElementById('recipe-detail-content');
  content.innerHTML = `
    <h2>${r.name}</h2>
    ${r.source ? `<p class="rd-source"><a href="${r.source}" target="_blank">View original recipe â†—</a></p>` : ''}
    ${r.body}
  `;
  showScreen('recipe-detail');
}

// ---- CATEGORY MODAL ----
let _catModalCallback = null;
function showCatModal(itemText, cats, callback) {
  _catModalCallback = callback;
  document.getElementById('cat-modal-title').textContent = `Where does "${itemText}" go?`;
  const btns = document.getElementById('cat-modal-buttons');
  btns.innerHTML = '';
  cats.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'cat-btn';
    btn.textContent = cat;
    btn.onclick = () => { closeCatModal(); callback(cat); };
    btns.appendChild(btn);
  });
  document.getElementById('cat-modal').classList.add('open');
}
function closeCatModal() {
  document.getElementById('cat-modal').classList.remove('open');
  _catModalCallback = null;
}

// ---- GROCERY CLEAR / RESET ----
function clearDoneGrocery() {
  groceryItems = groceryItems.filter(x => !x.done);
  localStorage.setItem('steph-grocery', JSON.stringify(groceryItems));
  renderGrocery();
}
function clearAllGrocery() {
  if (confirm('Clear the entire grocery list?')) {
    groceryItems = [];
    localStorage.setItem('steph-grocery', JSON.stringify(groceryItems));
    renderGrocery();
  }
}

// ---- CHECK FOR UPDATES ----
function checkForUpdates() {
  if ('caches' in window) {
    caches.keys().then(names => names.forEach(n => caches.delete(n)));
  }
  // Force hard reload bypassing cache
  window.location.reload(true);
}

// ---- INIT ----
renderToday();
</script>
</body>
</html>
